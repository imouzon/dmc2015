class <- read.csv("/Users/epwalsh/GitHub/dmc2015/data/raw_data/DMC_2015_orders_class.txt", sep="|")
train <- read.csv("/Users/epwalsh/GitHub/dmc2015/data/raw_data/DMC_2015_orders_train.txt", sep="|")

# > str(train)
# 'data.frame':	6053 obs. of  32 variables:
#   $ orderID        : int  1 2 3 4 5 6 7 8 9 10 ...
# $ orderTime      : Factor w/ 6048 levels "2015-01-06 09:38:35",..: 1 2 3 4 5 6 7 8 9 10 ...
# $ userID         : Factor w/ 2961 levels "003f4793b75faafc02ea079baf9e438e",..: 2872 882 2160 2370 1860 350 1664 1596 1636 1695 ...
# $ couponsReceived: Factor w/ 5800 levels "2015-01-06 09:02:41",..: 3 4 2 6 5 41 18 76 62 83 ...
# $ couponID1      : Factor w/ 1266 levels "000c1c04f1366b7dc54f74d2bc67f669",..: 659 42 771 45 1215 805 1169 784 799 712 ...
# $ price1         : num  3.24 2.32 7.92 2.5 12.27 ...
# $ basePrice1     : num  5.4 1.59 2.64 2.08 2.45 1.25 2.59 2.04 4.54 1.25 ...
# $ reward1        : num  1.57 1.57 1.26 1.57 1.26 0.63 1.26 0.94 1.26 0.94 ...
# $ premiumProduct1: int  0 0 1 0 0 0 1 1 0 0 ...
# $ brand1         : Factor w/ 27 levels "","26e65f6bb72fc288e6c3d3d1645dc61b",..: 13 25 7 16 16 25 7 7 1 25 ...
# $ productGroup1  : Factor w/ 174 levels "008b99d9c2fd9d58dd1483e364f8e8d3",..: 132 158 134 174 134 15 134 134 32 15 ...
# $ categoryIDs1   : Factor w/ 127 levels "1f26675d7c5cfea5899291a241171282",..: 79 27 80 78 78 65 80 80 92 65 ...
# $ couponID2      : Factor w/ 1650 levels "00393f0fbb088ca37e53cd1da5dd6035",..: 1568 479 1144 1540 130 805 1138 611 918 1442 ...
# $ price2         : num  5.19 3.7 4.17 3.66 5.74 4.35 10 4.82 3.98 3.06 ...
# $ basePrice2     : num  0.57 1.85 1.39 0.73 0.88 1.44 1.33 0.6 1.99 0.61 ...
# $ reward2        : num  1.57 0.94 1.26 1.57 1.57 1.26 0.94 1.57 1.88 1.26 ...
# $ premiumProduct2: int  0 0 1 1 1 0 0 0 0 1 ...
# $ brand2         : Factor w/ 23 levels "","26e65f6bb72fc288e6c3d3d1645dc61b",..: 22 1 7 7 7 1 1 1 22 7 ...
# $ productGroup2  : Factor w/ 180 levels "008b99d9c2fd9d58dd1483e364f8e8d3",..: 7 178 88 1 166 179 64 1 153 4 ...
# $ categoryIDs2   : Factor w/ 136 levels "1689ee628e9dbb508b05b9d9f2fdd147,796c5815752a170021838a78bf7fab34",..: 119 134 112 113 112 67 31 109 51 31 ...
# $ couponID3      : Factor w/ 1930 levels "0020c31413e72d4fecf01c42b41907e1",..: 1449 943 523 725 538 566 66 219 1213 360 ...
# $ price3         : num  12.92 3.89 2.73 5.74 4.91 ...
# $ basePrice3     : num  12.92 0.06 0.88 4.25 2.45 ...
# $ reward3        : num  2.2 2.2 1.26 1.57 1.57 3.14 1.88 1.57 1.26 1.26 ...
# $ premiumProduct3: int  0 0 0 0 1 0 0 1 0 0 ...
# $ brand3         : Factor w/ 25 levels "","26e65f6bb72fc288e6c3d3d1645dc61b",..: 1 24 4 4 7 1 24 7 1 1 ...
# $ productGroup3  : Factor w/ 207 levels "008b99d9c2fd9d58dd1483e364f8e8d3",..: 115 197 182 141 172 75 172 86 98 69 ...
# $ categoryIDs3   : Factor w/ 123 levels "1689ee628e9dbb508b05b9d9f2fdd147,796c5815752a170021838a78bf7fab34",..: 52 120 30 30 27 27 27 27 3 118 ...
# $ coupon1Used    : int  0 1 0 1 0 1 0 1 0 1 ...
# $ coupon2Used    : int  1 0 0 1 0 0 0 1 0 0 ...
# $ coupon3Used    : int  0 1 0 0 0 1 0 1 0 1 ...

library(lubridate)
library(ggplot2)
library(dplyr)

ymd_hms(train$orderTime[1]) - ymd_hms(train$orderTime[2])
summary(train$basketValue)
# what about customers that didn't buy anything?

time_diff = ymd_hms(train$orderTime) - ymd_hms(train$couponsReceived)


min_diff = as.numeric(time_diff) / 60

# indicates different expiration times
qplot(min_diff, geom="histogram", colour=I("white"))

train$minute_diff <- min_diff

train %>% subset(basketValue < 1000) %>%
  ggplot(aes(x = minute_diff, y = basketValue)) + geom_point()

# coupon 1 used the most, then coupon 2, then coupon 3
sum(train$coupon1Used)
sum(train$coupon2Used)
sum(train$coupon3Used)







